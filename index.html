<!DOCTYPE html>
<html>
<head>
    <title>上传图片到腾讯云</title>
    <script src="https://cdn.jsdelivr.net/npm/cos-js-sdk-v5/dist/cos-js-sdk-v5.min.js"></script>
</head>
<body>
    <input type="file" id="fileInput" accept="image/*">
    <button onclick="upload()">上传</button>

    <script>
        const bucket = 'shijuanshibie-1343742632';
        const region = 'ap-beijing'; // 北京地域的region代码是ap-beijing

        async function getTempKey() {
            const res = await fetch(
                'https://analyze-4gbej3877844ea2d-1343742632.ap-shanghai.app.tcloudbase.com/shangchuan', // 例如：https://your-env-id.service.tcloudbase.com/getTempKey
                { method: 'POST' }
            );
            return res.json();
        }

        async function upload() {
            const file = document.getElementById('fileInput').files[0];
            if (!file) return alert('请选择文件');

            const tempKey = await getTempKey();
            
            const cos = new COS({
                getAuthorization: (options, callback) => {
                    callback({
                        TmpSecretId: tempKey.tmpSecretId,
                        TmpSecretKey: tempKey.tmpSecretKey,
                        XCosSecurityToken: tempKey.sessionToken,
                        StartTime: tempKey.startTime,
                        ExpiredTime: tempKey.expiredTime,
                    });
                }
            });

            cos.putObject({
                Bucket: bucket,
                Region: region,
                Key: 'images/' + file.name,
                Body: file,
            }, (err, data) => {
                if (err) console.error(err);
                else alert('上传成功！URL: ' + data.Location);
            });
        }
    </script>
</body>
</html>
